/*! dwg 2016-05-30 */
!function(a){var b,c,d,e=function(a){a.unbind(),a.bind("mousedown",function(a){c.add(b.makeCircle(a.offsetX,a.offsetY,1)),d(),b.update()})},f=function(a){a.unbind();var e,f,g,h,i,j=!1,k=!0;a.bind("mousedown",function(a){k?(j=!0,e=a.offsetX,f=a.offsetY,i=b.makeLine(e,f,e+1,f),k=!1):(j=!1,g=a.offsetX,h=a.offsetY,i.remove(),c.add(b.makeLine(e,f,g,h)),d(),b.update(),k=!0)}),a.bind("mousemove",function(a){j&&(i.remove(),g=a.offsetX,h=a.offsetY,i=b.makeLine(e,f,g,h),d(),b.update())})},g=function(a){a.unbind();var e,f,g,h,i,j=!1,k=!0;a.bind("mousedown",function(a){k?(j=!0,e=a.offsetX,f=a.offsetY,i=b.makeRectangle(e,f,1,1),k=!1):(j=!1,g=a.offsetX-e,h=a.offsetY-f,i.remove(),c.add(b.makeRectangle(e,f,2*g,2*h)),d(),b.update(),k=!0)}),a.bind("mousemove",function(a){j&&(i.remove(),g=a.offsetX-e,h=a.offsetY-f,i=b.makeRectangle(e,f,2*g,2*h),d(),b.update())})},h=function(a){a.unbind();var e,f,g,h,i,j=!1,k=!0;a.bind("mousedown",function(a){if(k)j=!0,e=a.offsetX,f=a.offsetY,i=b.makeCircle(e,f,10),k=!1;else{j=!1,g=a.offsetX-e,h=a.offsetY-f;var l=Math.sqrt(g*g+h*h);i.remove(),c.add(b.makeCircle(e,f,l)),d(),b.update(),k=!0}}),a.bind("mousemove",function(a){if(j){i.remove(),g=a.offsetX-e,h=a.offsetY-f;var c=Math.sqrt(g*g+h*h);i=b.makeCircle(e,f,c),d(),b.update()}})},i=function(a){a.unbind();var e,f,g,h,i,j=!1,k=!0;a.bind("mousedown",function(a){k?(j=!0,e=a.offsetX,f=a.offsetY,i=b.makeEllipse(e,f,10,10),clickIndex=1,k=!1):(j=!1,g=a.offsetX-e,h=a.offsetY-f,i.remove(),c.add(b.makeEllipse(e,f,g,h)),d(),b.update(),k=!0)}),a.bind("mousemove",function(a){j&&(i.remove(),g=a.offsetX-e,h=a.offsetY-f,i=b.makeEllipse(e,f,g,h),d(),b.update())})},j=function(a){a.unbind();var e,f,g,h,i=!1,j=!0;a.bind("mousedown",function(a){if(j)e=a.offsetX,f=a.offsetY,h=b.makePolygon(e,f,10,5),j=!1,i=!0;else{i=!1;var k=a.offsetX-e,l=a.offsetY-f,m=Math.sqrt(k*k+l*l);g=Math.acos(l/m),h.remove(),h=b.makePolygon(e,f,m,5),h.rotation=-g,c.add(h),d(),b.update(),j=!0}}),a.bind("mousemove",function(a){if(i){h.remove();var c=a.offsetX-e,j=a.offsetY-f,k=Math.sqrt(c*c+j*j);g=Math.acos(j/k),h=b.makePolygon(e,f,k,5),h.rotation=-g,d(),b.update()}})},k=function(a,e){a.unbind();var f,g,h,i,j,k=!1,l=0;a.bind("mousedown",function(a){if(0===l)f=a.offsetX,g=a.offsetY,l=1;else if(1===l)h=a.offsetX,i=a.offsetY,j=b.makeLine(f,n,h,i),l=2,k=!0;else if(2===l){k=!1;var m=a.offsetX,n=a.offsetY;j.remove(),console.log(f,g,h,i,m,n),j=b.makeCurve(f,g,h,i,m,n,e),c.add(j),d(),b.update(),l=0}}),a.bind("mousemove",function(a){if(k){j.remove();var c=a.offsetX,l=a.offsetY;j.remove(),j=b.makeCurve(f,g,h,i,c,l,e),d(),b.update()}})},l=function(a){a.unbind();var e,f,g,h,i,j=!1,k=0;a.bind("mousedown",function(a){if(0===k)e=a.offsetX,f=a.offsetY,k=1;else if(1===k){var l=a.offsetX-e,m=a.offsetY-f;g=Math.sqrt(l*l+m*m),i=b.makeStar(e,f,g,g+10,5),k=2,j=!0}else if(2===k){j=!1;var l=a.offsetX-e,m=a.offsetY-f,n=Math.sqrt(l*l+m*m);h=Math.acos(m/n),i.remove(),i=b.makeStar(e,f,g,n,5),i.rotation=-h,c.add(i),d(),b.update(),k=0}}),a.bind("mousemove",function(a){if(j){i.remove();var c=a.offsetX-e,k=a.offsetY-f,l=Math.sqrt(c*c+k*k);h=Math.acos(k/l),i=b.makeStar(e,f,g,l,5),i.rotation=-h,d(),b.update()}})},m=function(a){a.unbind()};a.fn.extend({dwg:function(n){switch(n){case"point":e(this);break;case"line":f(this);break;case"rect":g(this);break;case"circle":h(this);break;case"ellipse":i(this);break;case"polygon":j(this);break;case"curve":k(this,!0);break;case"closedcurve":k(this,!1);break;case"star":l(this);break;case"clear":b.clear(),c=b.makeGroup(),b.update();break;case"exit":m(this);break;default:b||(b=new Two({width:this.width(),height:this.height()}).appendTo(this[0]),c=b.makeGroup());var o={stroke:"#000",linewidth:1,fill:!1};n=a.extend(o,n),d=function(){c.linewidth=n.linewidth,c.stroke=n.stroke,c.fill=n.fill,c.noFill()}}}})}(jQuery);